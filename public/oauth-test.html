<!DOCTYPE html>
<html>
<head>
    <title>Google OAuth Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 15px 30px; margin: 10px; font-size: 16px; cursor: pointer; }
        .oauth-btn { background: #4285f4; color: white; border: none; border-radius: 5px; }
        .log { margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 3px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Google OAuth Test</h1>
    
    <div id="info">
        <p><strong>Current URL:</strong> <span id="current-url"></span></p>
        <p><strong>Redirect URL:</strong> <span id="redirect-url"></span></p>
    </div>
    
    <button class="oauth-btn" onclick="testGoogleAuth()">Google ile Giriş Yap (Test)</button>
    <button onclick="goToMainApp()">Ana Uygulamaya Git</button>
    <button onclick="testAuthCallback()">AuthCallback Test</button>
    
    <div id="logs"></div>
    
    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';
        
        // Supabase config (same as app)
        const supabaseUrl = 'https://kjvtbgdiqxsbjrchzrqt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtqdnRiZ2RpcXhzYmpyY2h6cnF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjY4MzkxNDQsImV4cCI6MjA0MjQxNTE0NH0.CDx4iUK1mUpHSzD0WTGgNk09p9aOqW_ZUPaXt3NTajE';
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const className = type;
            logsDiv.innerHTML += `<div class="log ${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
            console.log(message);
        }
        
        function updateInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('redirect-url').textContent = `${window.location.origin}/auth/callback`;
        }
        
        window.testGoogleAuth = async function() {
            try {
                log('Google OAuth başlatılıyor...', 'info');
                
                const redirectUrl = `${window.location.origin}/auth/callback`;
                log(`Redirect URL: ${redirectUrl}`, 'info');
                
                const { data, error } = await supabase.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: redirectUrl
                    }
                });
                
                if (error) {
                    log(`OAuth hatası: ${error.message}`, 'error');
                    console.error('OAuth error:', error);
                } else {
                    log('OAuth başarıyla başlatıldı!', 'success');
                    console.log('OAuth data:', data);
                }
            } catch (error) {
                log(`OAuth exception: ${error.message}`, 'error');
                console.error('OAuth exception:', error);
            }
        };
        
        window.goToMainApp = function() {
            window.location.href = '/';
        };
        
        window.testAuthCallback = function() {
            window.location.href = '/auth/callback#access_token=test_token_12345&refresh_token=test_refresh_67890&expires_at=1754663711&token_type=bearer';
        };
        
        // Page load
        updateInfo();
        log('OAuth test sayfası yüklendi', 'success');
        
        // Listen for auth state changes
        supabase.auth.onAuthStateChange((event, session) => {
            log(`Auth state changed: ${event}`, 'info');
            if (session) {
                log(`User logged in: ${session.user.email}`, 'success');
            } else {
                log('User logged out', 'info');
            }
        });
    </script>
</body>
</html>
